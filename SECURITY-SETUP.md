# ğŸ” å®‰å…¨é…ç½®æŒ‡å—

## é—®é¢˜è¯Šæ–­

ä½ é‡åˆ°çš„é—®é¢˜æ˜¯ï¼šè™½ç„¶åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®äº† `.env` æ–‡ä»¶ï¼Œä½†å¯†ç ä»ç„¶æ˜¯é»˜è®¤çš„ `admin123`ã€‚

### æ ¹æœ¬åŸå› 

1. **é…ç½®ä¼˜å…ˆçº§é—®é¢˜**: `ecosystem.config.js` ä¸­ç¡¬ç¼–ç äº†ç¯å¢ƒå˜é‡ï¼ŒPM2 ä¼˜å…ˆä½¿ç”¨äº†é…ç½®æ–‡ä»¶ä¸­çš„å€¼è€Œä¸æ˜¯ `.env` æ–‡ä»¶
2. **å¼±å¯†ç å“ˆå¸Œ**: åŸæœ‰çš„å“ˆå¸Œå€¼å¯¹åº”çš„æ˜¯å¼±å¯†ç 

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

åœ¨ä½ çš„æœåŠ¡å™¨ä¸Š (`/srv/docs/markdown-site/`) æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```bash
# 1. ä¸Šä¼ æ›´æ–°çš„æ–‡ä»¶åˆ°æœåŠ¡å™¨
# å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°ä½ çš„æœåŠ¡å™¨ï¼š
# - ecosystem.config.js (å·²æ›´æ–°ï¼Œç§»é™¤ç¡¬ç¼–ç )
# - update-security.sh (è‡ªåŠ¨åŒ–è„šæœ¬)
# - generate-password-hash.js (å¯†ç ç”Ÿæˆå·¥å…·)

# 2. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x update-security.sh

# 3. è¿è¡Œè‡ªåŠ¨åŒ–è„šæœ¬
./update-security.sh

# 4. æŒ‰æç¤ºæ“ä½œ
# - è„šæœ¬ä¼šè¦æ±‚ä½ è¾“å…¥æ–°çš„ç®¡ç†å‘˜å¯†ç 
# - éœ€è¦è¾“å…¥ä¸¤æ¬¡è¿›è¡Œç¡®è®¤
# - å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦
# - è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆå¯†ç å“ˆå¸Œå¹¶æ›´æ–°é…ç½®
# - è‡ªåŠ¨é‡å¯ PM2 åº”ç”¨
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ›´æ–°

å¦‚æœä½ ä¸æƒ³ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. å¤‡ä»½å½“å‰ .env æ–‡ä»¶
cp .env .env.backup

# 2. ç”Ÿæˆæ–°çš„å¯†ç å“ˆå¸Œ
node generate-password-hash.js
# æŒ‰æç¤ºè¾“å…¥ä½ çš„æ–°å¯†ç ï¼Œå¤åˆ¶ç”Ÿæˆçš„å“ˆå¸Œå€¼

# 3. æ›´æ–° .env æ–‡ä»¶å†…å®¹
cat > .env << 'EOF'
# ç®¡ç†å‘˜å¯†ç å“ˆå¸Œ (ä½¿ç”¨ä¸Šä¸€æ­¥ç”Ÿæˆçš„å“ˆå¸Œå€¼)
ADMIN_PASSWORD_HASH=ä½ ç”Ÿæˆçš„å“ˆå¸Œå€¼

# JWT å¯†é’¥ (è‡ªåŠ¨ç”Ÿæˆçš„éšæœºå¯†é’¥)
JWT_SECRET=your-super-secret-jwt-key-change-in-production-min-32-chars-$(date +%s)

# ç¯å¢ƒè®¾ç½®
NODE_ENV=production

# æœåŠ¡ç«¯å£
PORT=3001
EOF

# 4. éªŒè¯ .env æ–‡ä»¶å†…å®¹
cat .env
```

### æ­¥éª¤ 2: æ›´æ–° ecosystem.config.js

ç¡®ä¿ä½ çš„ `ecosystem.config.js` æ–‡ä»¶ä¸åŒ…å«ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯ï¼š

```javascript
module.exports = {
  apps: [
    {
      name: 'docs-platform',
      script: 'npm',
      args: 'start',
      cwd: './',
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '1G',
      env: {
        NODE_ENV: 'production',
        PORT: 3001,
        // æ•æ„Ÿä¿¡æ¯ä» .env æ–‡ä»¶è¯»å–
      },
      env_production: {
        NODE_ENV: 'production',
        PORT: 3001,
        // æ•æ„Ÿä¿¡æ¯ä» .env æ–‡ä»¶è¯»å–
      },
      error_file: './logs/err.log',
      out_file: './logs/out.log',
      log_file: './logs/combined.log',
      time: true
    }
  ]
};
```

### æ­¥éª¤ 3: é‡å¯åº”ç”¨

```bash
# é‡å¯ PM2 åº”ç”¨
pm2 restart docs-platform

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®ç”Ÿæ•ˆ
pm2 logs docs-platform --lines 20
```

## ğŸ”‘ ç™»å½•å‡­æ®

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: ä½ åœ¨è„šæœ¬ä¸­è®¾ç½®çš„å¯†ç 

> ğŸ’¡ **æç¤º**: å¦‚æœä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¯†ç å°±æ˜¯ä½ åœ¨è¿è¡Œè„šæœ¬æ—¶è¾“å…¥çš„å¯†ç ã€‚å¦‚æœæ‰‹åŠ¨æ›´æ–°ï¼Œå¯†ç å°±æ˜¯ä½ åœ¨ç”Ÿæˆå“ˆå¸Œæ—¶è¾“å…¥çš„å¯†ç ã€‚

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### 1. ç”Ÿæˆä½ è‡ªå·±çš„å¯†ç 

ä½¿ç”¨æä¾›çš„å·¥å…·ç”Ÿæˆæ–°å¯†ç ï¼š

```bash
node generate-password-hash.js
```

### 2. æ›´å¼ºçš„ JWT å¯†é’¥

ç”Ÿæˆæ›´å®‰å…¨çš„ JWT å¯†é’¥ï¼š

```bash
# ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
openssl rand -base64 32

# æˆ–è€…ä½¿ç”¨ Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### 3. å®šæœŸæ›´æ¢å¯†ç 

å»ºè®®æ¯3-6ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ç®¡ç†å‘˜å¯†ç ã€‚

### 4. ç›‘æ§ç™»å½•æ—¥å¿—

å®šæœŸæ£€æŸ¥åº”ç”¨æ—¥å¿—ï¼Œå…³æ³¨å¼‚å¸¸ç™»å½•å°è¯•ï¼š

```bash
pm2 logs docs-platform | grep -i "login\|auth\|password"
```

## ğŸ” éªŒè¯é…ç½®

### æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ

åœ¨åº”ç”¨å¯åŠ¨åï¼ŒæŸ¥çœ‹æ—¥å¿—ä¸­çš„è°ƒè¯•ä¿¡æ¯ï¼š

```bash
pm2 logs docs-platform | grep "ç¯å¢ƒå˜é‡è°ƒè¯•ä¿¡æ¯" -A 5
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
ğŸ” ç¯å¢ƒå˜é‡è°ƒè¯•ä¿¡æ¯:
NODE_ENV: production
JWT_SECRET: å·²è®¾ç½®
ADMIN_PASSWORD_HASH: å·²è®¾ç½®
ADMIN_PASSWORD_HASH é•¿åº¦: 60
```

### æµ‹è¯•ç™»å½•

1. è®¿é—®ç®¡ç†ç•Œé¢ (http://localhost:3001)
2. ä½¿ç”¨ä½ è®¾ç½®çš„æ–°å¯†ç ç™»å½•
3. ç¡®è®¤ç™»å½•æˆåŠŸå¹¶èƒ½æ­£å¸¸è®¿é—®ç®¡ç†åŠŸèƒ½

## ğŸ“‹ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶æ— æ³•ç™»å½•

1. **æ£€æŸ¥ .env æ–‡ä»¶æƒé™**:
   ```bash
   ls -la .env
   chmod 600 .env  # ç¡®ä¿åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
   ```

2. **ç¡®è®¤ PM2 è¯»å–äº† .env æ–‡ä»¶**:
   ```bash
   pm2 restart docs-platform --update-env
   ```

3. **æ£€æŸ¥åº”ç”¨æ—¥å¿—**:
   ```bash
   pm2 logs docs-platform --lines 50
   ```

### å¦‚æœå¿˜è®°å¯†ç 

ä½¿ç”¨ `generate-password-hash.js` å·¥å…·é‡æ–°ç”Ÿæˆå¯†ç å“ˆå¸Œï¼Œç„¶åæ›´æ–° `.env` æ–‡ä»¶å¹¶é‡å¯åº”ç”¨ã€‚

## ğŸš¨ ç´§æ€¥æ¢å¤

å¦‚æœå®Œå…¨æ— æ³•è®¿é—®ï¼Œå¯ä»¥ä¸´æ—¶å¯ç”¨å¼€å‘æ¨¡å¼ï¼š

```bash
# ä¸´æ—¶ç§»é™¤ ADMIN_PASSWORD_HASH ç¯å¢ƒå˜é‡
mv .env .env.disabled
echo "NODE_ENV=development" > .env
pm2 restart docs-platform
```

è¿™å°†å¯ç”¨é»˜è®¤å¯†ç  `admin123`ï¼Œç™»å½•åç«‹å³é‡æ–°é…ç½®å®‰å…¨å¯†ç ã€‚
