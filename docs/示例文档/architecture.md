# ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

æœ¬ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯ä¸€ä½“åŒ–æ¶æ„ï¼ŒåŸºäº Next.js 14 App Router æ„å»ºï¼Œå…·å¤‡ç”Ÿäº§çº§çš„å®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[ç”¨æˆ·ç•Œé¢] --> B[æ–‡æ¡£é¢„è§ˆ]
        A --> C[ç®¡ç†ç•Œé¢]
        A --> D[æœç´¢åŠŸèƒ½]
    end
    
    subgraph "APIå±‚"
        E[è®¤è¯API] --> F[JWTéªŒè¯]
        G[æ–‡æ¡£API] --> H[CRUDæ“ä½œ]
        I[æœç´¢API] --> J[å…¨æ–‡æ£€ç´¢]
        K[æ–‡ä»¶æ“ä½œAPI] --> L[æ‹–æ‹½/é‡å‘½å]
    end
    
    subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
        M[æ–‡æ¡£ç®¡ç†] --> N[Markdownè§£æ]
        O[æ–‡ä»¶ç³»ç»Ÿç®¡ç†] --> P[å®‰å…¨è·¯å¾„éªŒè¯]
        Q[è®¤è¯ç®¡ç†] --> R[å¯†ç å“ˆå¸Œ]
    end
    
    subgraph "æ•°æ®å±‚"
        S[æ–‡ä»¶ç³»ç»Ÿ] --> T[Markdownæ–‡ä»¶]
        U[ç¯å¢ƒå˜é‡] --> V[é…ç½®ç®¡ç†]
    end
    
    A --> E
    A --> G
    A --> I
    A --> K
    E --> Q
    G --> M
    I --> M
    K --> O
    M --> S
    O --> S
    Q --> U
```

## ğŸ“ ç›®å½•ç»“æ„è®¾è®¡

### æ ¸å¿ƒåŸåˆ™
1. **å…³æ³¨ç‚¹åˆ†ç¦»**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç 
2. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„å±‚æ¬¡ç»“æ„
3. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
4. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ

### ç›®å½•è¯´æ˜

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†ç•Œé¢è·¯ç”±
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ admin/         # ç®¡ç†åŠŸèƒ½
â”‚   â”‚   â””â”€â”€ search/        # æœç´¢åŠŸèƒ½
â”‚   â”œâ”€â”€ docs/              # æ–‡æ¡£é¢„è§ˆè·¯ç”±
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç»„ä»¶
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†ç•Œé¢ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                # é€šç”¨UIç»„ä»¶
â”‚   â””â”€â”€ ...                # å…¶ä»–åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ lib/                   # å·¥å…·åº“å’Œä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ auth.ts            # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ docs.ts            # æ–‡æ¡£å¤„ç†
â”‚   â””â”€â”€ file-operations.ts # æ–‡ä»¶æ“ä½œ
â””â”€â”€ types/                 # TypeScript ç±»å‹å®šä¹‰
```

## ğŸ” å®‰å…¨æ¶æ„

### è®¤è¯ç³»ç»Ÿ
- **JWT Token**: æ— çŠ¶æ€è®¤è¯
- **bcrypt å“ˆå¸Œ**: å¯†ç å®‰å…¨å­˜å‚¨
- **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯éš”ç¦»
- **è·¯å¾„éªŒè¯**: é˜²æ­¢ç›®å½•éå†æ”»å‡»

### å®‰å…¨æªæ–½
```typescript
// è·¯å¾„å®‰å…¨éªŒè¯
private validatePath(filePath: string): boolean {
  const resolvedPath = path.resolve(this.basePath, filePath);
  return resolvedPath.startsWith(this.basePath);
}

// JWT è®¤è¯ä¸­é—´ä»¶
export function authenticateRequest(request: NextRequest) {
  const token = request.headers.get('authorization')?.replace('Bearer ', '');
  if (!token) return null;
  
  try {
    return jwt.verify(token, JWT_SECRET) as { userId: string };
  } catch {
    return null;
  }
}
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### æ–‡ä»¶ç®¡ç†æµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant UI as ç•Œé¢
    participant API as APIå±‚
    participant FS as æ–‡ä»¶ç³»ç»Ÿ
    participant FSM as æ–‡ä»¶ç®¡ç†å™¨
    
    U->>UI: æ‹–æ‹½æ–‡ä»¶
    UI->>API: POST /api/admin/file-operations
    API->>FSM: validatePath()
    FSM->>FS: æ£€æŸ¥è·¯å¾„å®‰å…¨
    FS-->>FSM: éªŒè¯ç»“æœ
    FSM->>FS: æ‰§è¡Œæ–‡ä»¶æ“ä½œ
    FS-->>FSM: æ“ä½œç»“æœ
    FSM-->>API: è¿”å›ç»“æœ
    API-->>UI: å“åº”çŠ¶æ€
    UI-->>U: æ›´æ–°ç•Œé¢
```

### çŠ¶æ€ç®¡ç†
- **æœ¬åœ°çŠ¶æ€**: React useState/useEffect
- **å…¨å±€çŠ¶æ€**: Context API (æœªæ¥å¯æ‰©å±• Zustand)
- **æœåŠ¡å™¨çŠ¶æ€**: SWR/React Query (æœªæ¥ä¼˜åŒ–)

## ğŸ¨ ç»„ä»¶æ¶æ„

### è®¾è®¡åŸåˆ™
1. **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **å¯å¤ç”¨æ€§**: é€šç”¨ç»„ä»¶æŠ½è±¡
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ Props ç±»å‹å®šä¹‰
4. **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨ memo å’Œ callback

### ç»„ä»¶å±‚æ¬¡
```
AdminPage (å®¹å™¨ç»„ä»¶)
â”œâ”€â”€ EnhancedFileTree (æ–‡ä»¶æ ‘)
â”‚   â”œâ”€â”€ TreeNode (æ ‘èŠ‚ç‚¹)
â”‚   â”œâ”€â”€ ContextMenu (å³é”®èœå•)
â”‚   â””â”€â”€ RenameInput (é‡å‘½åè¾“å…¥)
â”œâ”€â”€ MarkdownEditor (ç¼–è¾‘å™¨)
â”‚   â”œâ”€â”€ Toolbar (å·¥å…·æ )
â”‚   â”œâ”€â”€ Editor (ç¼–è¾‘åŒº)
â”‚   â””â”€â”€ Preview (é¢„è§ˆåŒº)
â”œâ”€â”€ DragDropUpload (æ‹–æ‹½ä¸Šä¼ )
â””â”€â”€ CreateFileDialog (åˆ›å»ºæ–‡ä»¶å¯¹è¯æ¡†)
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
- **å›¾ç‰‡ä¼˜åŒ–**: Next.js Image ç»„ä»¶
- **ç¼“å­˜ç­–ç•¥**: æµè§ˆå™¨ç¼“å­˜å’Œ CDN
- **æ‡’åŠ è½½**: è™šæ‹Ÿæ»šåŠ¨å¤§å‹åˆ—è¡¨

### åç«¯ä¼˜åŒ–
- **æ–‡ä»¶ç¼“å­˜**: å†…å­˜ç¼“å­˜å¸¸ç”¨æ–‡æ¡£
- **å¢é‡æ›´æ–°**: åªæ›´æ–°å˜æ›´çš„æ–‡ä»¶
- **å‹ç¼©ä¼ è¾“**: Gzip å‹ç¼©
- **å¹¶å‘å¤„ç†**: å¼‚æ­¥æ–‡ä»¶æ“ä½œ

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶ç³»ç»Ÿ (æœªæ¥)
```typescript
interface Plugin {
  name: string;
  version: string;
  init: (app: Application) => void;
  destroy: () => void;
}

// æ’ä»¶æ³¨å†Œ
class PluginManager {
  private plugins: Map<string, Plugin> = new Map();
  
  register(plugin: Plugin) {
    this.plugins.set(plugin.name, plugin);
    plugin.init(this.app);
  }
}
```

### æ•°æ®åº“æ”¯æŒ (æœªæ¥)
- **SQLite**: è½»é‡çº§éƒ¨ç½²
- **PostgreSQL**: ç”Ÿäº§ç¯å¢ƒ
- **MongoDB**: æ–‡æ¡£å­˜å‚¨

### å¤šç§Ÿæˆ·æ”¯æŒ (æœªæ¥)
- **ç”¨æˆ·ç®¡ç†**: å¤šç”¨æˆ·æƒé™
- **ç©ºé—´éš”ç¦»**: ç§Ÿæˆ·æ•°æ®éš”ç¦»
- **é…é¢ç®¡ç†**: å­˜å‚¨å’ŒåŠŸèƒ½é™åˆ¶

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### é”™è¯¯ç›‘æ§
- **Sentry**: é”™è¯¯è¿½è¸ª
- **æ—¥å¿—ç³»ç»Ÿ**: ç»“æ„åŒ–æ—¥å¿—
- **æ€§èƒ½ç›‘æ§**: Core Web Vitals

### è¿ç»´æ”¯æŒ
- **å¥åº·æ£€æŸ¥**: API å¥åº·çŠ¶æ€
- **æŒ‡æ ‡æ”¶é›†**: Prometheus å…¼å®¹
- **å‘Šè­¦ç³»ç»Ÿ**: å¼‚å¸¸é€šçŸ¥

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”
```
E2E Tests (Playwright)
â”œâ”€â”€ ç”¨æˆ·æµç¨‹æµ‹è¯•
â””â”€â”€ è·¨æµè§ˆå™¨æµ‹è¯•

Integration Tests (Jest)
â”œâ”€â”€ API é›†æˆæµ‹è¯•
â””â”€â”€ ç»„ä»¶é›†æˆæµ‹è¯•

Unit Tests (Jest + Testing Library)
â”œâ”€â”€ å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ ç»„ä»¶å•å…ƒæµ‹è¯•
â””â”€â”€ ä¸šåŠ¡é€»è¾‘æµ‹è¯•
```

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
- **å•å…ƒæµ‹è¯•**: > 80%
- **é›†æˆæµ‹è¯•**: > 60%
- **E2E æµ‹è¯•**: æ ¸å¿ƒç”¨æˆ·æµç¨‹

## ğŸš¢ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
- **æµ‹è¯•ç¯å¢ƒ**: Docker Compose
- **ç”Ÿäº§ç¯å¢ƒ**: Kubernetes/Docker Swarm

### CI/CD æµç¨‹
```yaml
# GitHub Actions ç¤ºä¾‹
name: Deploy
on:
  push:
    branches: [main]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm ci
      - run: npm test
      - run: npm run build
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - run: docker build -t app .
      - run: docker push registry/app
```

## ğŸ“‹ æŠ€æœ¯å€ºåŠ¡ç®¡ç†

### å½“å‰æŠ€æœ¯å€ºåŠ¡
1. **çŠ¶æ€ç®¡ç†**: éœ€è¦å¼•å…¥å…¨å±€çŠ¶æ€ç®¡ç†
2. **ç¼“å­˜ç­–ç•¥**: éœ€è¦å®ç°æ™ºèƒ½ç¼“å­˜
3. **æµ‹è¯•è¦†ç›–**: éœ€è¦è¡¥å……æµ‹è¯•ç”¨ä¾‹
4. **æ–‡æ¡£å®Œå–„**: éœ€è¦è¡¥å…… API æ–‡æ¡£

### é‡æ„è®¡åˆ’
- **Q1**: å¼•å…¥çŠ¶æ€ç®¡ç†åº“
- **Q2**: å®ç°ç¼“å­˜ç³»ç»Ÿ
- **Q3**: å®Œå–„æµ‹è¯•è¦†ç›–
- **Q4**: æ€§èƒ½ä¼˜åŒ–

---

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„**å¯ç»´æŠ¤æ€§**ã€**å¯æ‰©å±•æ€§**å’Œ**å®‰å…¨æ€§**ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
