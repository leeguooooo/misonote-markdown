# ååŒç¼–è¾‘æ¶æ„è®¾è®¡

## ğŸ¯ æŠ€æœ¯é€‰å‹

### ååŒç¼–è¾‘æ¡†æ¶å¯¹æ¯”

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Yjs + TipTap** â­ | CRDTç®—æ³•ã€ç¦»çº¿æ”¯æŒã€ç”Ÿæ€ä¸°å¯Œ | å­¦ä¹ æˆæœ¬ä¸­ç­‰ | **æ¨èæ–¹æ¡ˆ** |
| ProseMirror + Yjs | æˆç†Ÿç¨³å®šã€é«˜åº¦å¯å®šåˆ¶ | å¤æ‚åº¦é«˜ã€å¼€å‘æˆæœ¬å¤§ | å¤§å‹ä¼ä¸š |
| Slate.js + slate-yjs | Reactç”Ÿæ€ã€çµæ´»æ€§å¼º | æ€§èƒ½ä¸€èˆ¬ã€ç¤¾åŒºè¾ƒå° | Reacté¡¹ç›® |
| Quill + ShareJS | ç®€å•æ˜“ç”¨ã€å¿«é€Ÿé›†æˆ | åŠŸèƒ½æœ‰é™ã€æ‰©å±•æ€§å·® | ç®€å•åœºæ™¯ |

### ğŸ† **æœ€ç»ˆé€‰æ‹©: Yjs + TipTap**

**ç†ç”±**:
1. **CRDTç®—æ³•**: æ— éœ€ä¸­å¤®æœåŠ¡å™¨åè°ƒï¼Œæ”¯æŒç¦»çº¿ç¼–è¾‘
2. **ç”Ÿæ€ä¸°å¯Œ**: æ”¯æŒå¤šç§ç¼–è¾‘å™¨å’Œä¼ è¾“å±‚
3. **æ€§èƒ½ä¼˜ç§€**: å†…å­˜å ç”¨å°ï¼ŒåŒæ­¥é€Ÿåº¦å¿«
4. **æ‰©å±•æ€§å¼º**: æ”¯æŒæ’ä»¶ç³»ç»Ÿï¼Œæ˜“äºå®šåˆ¶
5. **ä¼ä¸šçº§**: è¢«å¤šå®¶500å¼ºå…¬å¸ä½¿ç”¨

## ğŸ—ï¸ æ–‡æ¡£å­˜å‚¨æ¶æ„

### æ··åˆå­˜å‚¨ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“å­˜å‚¨    â”‚    â”‚   æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨   â”‚    â”‚   å¯¹è±¡å­˜å‚¨      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ–‡æ¡£å…ƒæ•°æ®    â”‚    â”‚ â€¢ Markdownæºæ–‡ä»¶ â”‚    â”‚ â€¢ åª’ä½“æ–‡ä»¶      â”‚
â”‚ â€¢ ç‰ˆæœ¬ä¿¡æ¯      â”‚    â”‚ â€¢ å†å²ç‰ˆæœ¬      â”‚    â”‚ â€¢ å¤§å‹é™„ä»¶      â”‚
â”‚ â€¢ æƒé™å…³ç³»      â”‚    â”‚ â€¢ æ¨¡æ¿æ–‡ä»¶      â”‚    â”‚ â€¢ å¤‡ä»½æ–‡ä»¶      â”‚
â”‚ â€¢ åä½œçŠ¶æ€      â”‚    â”‚ â€¢ é…ç½®æ–‡ä»¶      â”‚    â”‚ â€¢ å¯¼å‡ºæ–‡ä»¶      â”‚
â”‚ â€¢ å®¡è®¡æ—¥å¿—      â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç»Ÿä¸€APIå±‚     â”‚
                    â”‚ â€¢ å­˜å‚¨æŠ½è±¡      â”‚
                    â”‚ â€¢ ç¼“å­˜ç®¡ç†      â”‚
                    â”‚ â€¢ åŒæ­¥æœºåˆ¶      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å­˜å‚¨ç­–ç•¥è¯¦è§£

#### 1. **æ•°æ®åº“å­˜å‚¨** (PostgreSQL)
```sql
-- æ–‡æ¡£è¡¨ (æ‰©å±•)
ALTER TABLE documents ADD COLUMN IF NOT EXISTS yjs_state BYTEA; -- YjsçŠ¶æ€
ALTER TABLE documents ADD COLUMN IF NOT EXISTS content_hash VARCHAR(64); -- å†…å®¹å“ˆå¸Œ
ALTER TABLE documents ADD COLUMN IF NOT EXISTS storage_type VARCHAR(20) DEFAULT 'hybrid'; -- å­˜å‚¨ç±»å‹
ALTER TABLE documents ADD COLUMN IF NOT EXISTS file_size BIGINT DEFAULT 0; -- æ–‡ä»¶å¤§å°
ALTER TABLE documents ADD COLUMN IF NOT EXISTS encoding VARCHAR(20) DEFAULT 'utf8'; -- ç¼–ç æ ¼å¼

-- æ–‡æ¡£å†…å®¹è¡¨ (æ–°å¢)
CREATE TABLE document_contents (
    id TEXT PRIMARY KEY,
    document_id INTEGER NOT NULL REFERENCES documents(id) ON DELETE CASCADE,
    content_type VARCHAR(20) NOT NULL CHECK (content_type IN ('markdown', 'yjs_update', 'snapshot')),
    content_data BYTEA NOT NULL, -- äºŒè¿›åˆ¶å†…å®¹æ•°æ®
    content_text TEXT, -- æ–‡æœ¬å†…å®¹ (ç”¨äºæœç´¢)
    version_number INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER REFERENCES users(id),
    metadata JSONB,

    UNIQUE(document_id, content_type, version_number)
);

-- å®æ—¶åä½œçŠ¶æ€è¡¨
CREATE TABLE collaboration_states (
    id TEXT PRIMARY KEY,
    document_id INTEGER NOT NULL REFERENCES documents(id) ON DELETE CASCADE,
    yjs_state BYTEA NOT NULL, -- Yjsæ–‡æ¡£çŠ¶æ€
    last_update_vector BYTEA, -- æœ€åæ›´æ–°å‘é‡
    active_users JSONB, -- å½“å‰æ´»è·ƒç”¨æˆ·
    last_sync_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. **æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨** (docs/)
```
docs/
â”œâ”€â”€ content/                    # æ–‡æ¡£å†…å®¹
â”‚   â”œâ”€â”€ {document_id}/
â”‚   â”‚   â”œâ”€â”€ current.md         # å½“å‰ç‰ˆæœ¬
â”‚   â”‚   â”œâ”€â”€ versions/          # å†å²ç‰ˆæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ v1.md
â”‚   â”‚   â”‚   â”œâ”€â”€ v2.md
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ snapshots/         # å¿«ç…§å¤‡ä»½
â”‚   â”‚       â”œâ”€â”€ daily/
â”‚   â”‚       â””â”€â”€ weekly/
â”œâ”€â”€ templates/                  # æ–‡æ¡£æ¨¡æ¿
â”œâ”€â”€ exports/                    # å¯¼å‡ºæ–‡ä»¶
â””â”€â”€ cache/                     # ç¼“å­˜æ–‡ä»¶
```

#### 3. **å¯¹è±¡å­˜å‚¨** (å¯é€‰ - ä¼ä¸šç‰ˆ)
- **åª’ä½“æ–‡ä»¶**: å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘
- **å¤§å‹é™„ä»¶**: PDFã€Officeæ–‡æ¡£
- **å¤‡ä»½æ–‡ä»¶**: å®šæœŸå¤‡ä»½
- **å¯¼å‡ºæ–‡ä»¶**: PDFã€Wordå¯¼å‡º

## ğŸ”„ ååŒç¼–è¾‘å®ç°

### Yjsé›†æˆæ¶æ„

```typescript
// æ–‡æ¡£åä½œç®¡ç†å™¨
export class DocumentCollaborationManager {
  private ydoc: Y.Doc;
  private provider: WebsocketProvider;
  private awareness: Awareness;

  constructor(documentId: string) {
    this.ydoc = new Y.Doc();
    this.provider = new WebsocketProvider(
      'ws://localhost:3001/collaboration',
      documentId,
      this.ydoc
    );
    this.awareness = this.provider.awareness;
  }

  // åˆå§‹åŒ–ç¼–è¾‘å™¨
  initEditor(element: HTMLElement) {
    const editor = new Editor({
      element,
      extensions: [
        StarterKit,
        Collaboration.configure({
          document: this.ydoc,
        }),
        CollaborationCursor.configure({
          provider: this.provider,
          user: {
            name: 'User Name',
            color: '#f783ac',
          },
        }),
      ],
    });

    return editor;
  }

  // ä¿å­˜åˆ°æ•°æ®åº“
  async saveToDatabase() {
    const update = Y.encodeStateAsUpdate(this.ydoc);
    const content = this.ydoc.getText('content').toString();

    await fetch('/api/documents/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        documentId: this.documentId,
        yjsUpdate: Array.from(update),
        content,
        contentHash: await this.calculateHash(content)
      })
    });
  }
}
```

### WebSocketæœåŠ¡å™¨

```typescript
// WebSocketåä½œæœåŠ¡å™¨
export class CollaborationServer {
  private wss: WebSocketServer;
  private rooms: Map<string, Set<WebSocket>> = new Map();
  private ydocs: Map<string, Y.Doc> = new Map();

  constructor(port: number) {
    this.wss = new WebSocketServer({ port });
    this.setupHandlers();
  }

  private setupHandlers() {
    this.wss.on('connection', (ws, req) => {
      const url = new URL(req.url!, `http://${req.headers.host}`);
      const documentId = url.searchParams.get('documentId');

      if (!documentId) {
        ws.close(1008, 'Document ID required');
        return;
      }

      this.handleDocumentConnection(ws, documentId);
    });
  }

  private async handleDocumentConnection(ws: WebSocket, documentId: string) {
    // åŠ å…¥æˆ¿é—´
    if (!this.rooms.has(documentId)) {
      this.rooms.set(documentId, new Set());
      await this.loadDocument(documentId);
    }

    this.rooms.get(documentId)!.add(ws);

    // å‘é€åˆå§‹çŠ¶æ€
    const ydoc = this.ydocs.get(documentId)!;
    const stateVector = Y.encodeStateVector(ydoc);
    ws.send(JSON.stringify({
      type: 'sync-step-1',
      stateVector: Array.from(stateVector)
    }));

    // å¤„ç†æ¶ˆæ¯
    ws.on('message', (data) => {
      this.handleMessage(ws, documentId, data);
    });

    // å¤„ç†æ–­å¼€è¿æ¥
    ws.on('close', () => {
      this.rooms.get(documentId)?.delete(ws);
      if (this.rooms.get(documentId)?.size === 0) {
        this.saveDocument(documentId);
      }
    });
  }

  private async loadDocument(documentId: string) {
    // ä»æ•°æ®åº“åŠ è½½YjsçŠ¶æ€
    const state = await this.loadYjsState(documentId);
    const ydoc = new Y.Doc();

    if (state) {
      Y.applyUpdate(ydoc, new Uint8Array(state));
    }

    this.ydocs.set(documentId, ydoc);

    // è®¾ç½®è‡ªåŠ¨ä¿å­˜
    ydoc.on('update', debounce(() => {
      this.saveDocument(documentId);
    }, 5000));
  }
}
```

## ğŸ“ ç›®å½•ç»“æ„é‡æ„

### æ–°çš„ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ collaboration/          # åä½œåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ yjs-manager.ts     # Yjsç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ websocket-server.ts # WebSocketæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ awareness.ts       # ç”¨æˆ·æ„ŸçŸ¥
â”‚   â”‚   â””â”€â”€ conflict-resolver.ts # å†²çªè§£å†³
â”‚   â”œâ”€â”€ storage/               # å­˜å‚¨æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ storage-adapter.ts # å­˜å‚¨é€‚é…å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ database-adapter.ts # æ•°æ®åº“é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ filesystem-adapter.ts # æ–‡ä»¶ç³»ç»Ÿé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ object-storage-adapter.ts # å¯¹è±¡å­˜å‚¨é€‚é…å™¨
â”‚   â””â”€â”€ documents/             # æ–‡æ¡£ç®¡ç†
â”‚       â”œâ”€â”€ document-manager.ts # æ–‡æ¡£ç®¡ç†å™¨
â”‚       â”œâ”€â”€ version-manager.ts # ç‰ˆæœ¬ç®¡ç†
â”‚       â””â”€â”€ content-processor.ts # å†…å®¹å¤„ç†
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ editor/                # ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CollaborativeEditor.tsx # åä½œç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ EditorToolbar.tsx  # ç¼–è¾‘å™¨å·¥å…·æ 
â”‚   â”‚   â”œâ”€â”€ UserCursors.tsx    # ç”¨æˆ·å…‰æ ‡
â”‚   â”‚   â””â”€â”€ OnlineUsers.tsx    # åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
â”‚   â””â”€â”€ documents/             # æ–‡æ¡£ç»„ä»¶
â”‚       â”œâ”€â”€ DocumentTree.tsx   # æ–‡æ¡£æ ‘
â”‚       â”œâ”€â”€ DocumentViewer.tsx # æ–‡æ¡£æŸ¥çœ‹å™¨
â”‚       â””â”€â”€ DocumentMetadata.tsx # æ–‡æ¡£å…ƒæ•°æ®
â””â”€â”€ app/
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ collaboration/     # åä½œAPI
    â”‚   â”‚   â”œâ”€â”€ websocket/     # WebSocketç«¯ç‚¹
    â”‚   â”‚   â””â”€â”€ sync/          # åŒæ­¥API
    â”‚   â””â”€â”€ documents/         # æ–‡æ¡£API
    â”‚       â”œâ”€â”€ content/       # å†…å®¹ç®¡ç†
    â”‚       â”œâ”€â”€ versions/      # ç‰ˆæœ¬ç®¡ç†
    â”‚       â””â”€â”€ storage/       # å­˜å‚¨ç®¡ç†
    â””â”€â”€ editor/                # ç¼–è¾‘å™¨é¡µé¢
        â””â”€â”€ [documentId]/      # åŠ¨æ€è·¯ç”±
```

## ğŸ”§ å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€æ¶æ„ (2å‘¨)
1. å®‰è£…å’Œé…ç½®Yjs + TipTap
2. åˆ›å»ºå­˜å‚¨æŠ½è±¡å±‚
3. æ‰©å±•æ•°æ®åº“è¡¨ç»“æ„
4. å®ç°åŸºç¡€WebSocketæœåŠ¡å™¨

### Phase 2: åä½œåŠŸèƒ½ (3å‘¨)
1. å®ç°å®æ—¶åä½œç¼–è¾‘
2. ç”¨æˆ·å…‰æ ‡å’Œé€‰æ‹©åŒæ­¥
3. åœ¨çº¿ç”¨æˆ·ç®¡ç†
4. å†²çªè§£å†³æœºåˆ¶

### Phase 3: å­˜å‚¨ä¼˜åŒ– (2å‘¨)
1. å®ç°æ··åˆå­˜å‚¨ç­–ç•¥
2. ç‰ˆæœ¬ç®¡ç†å’Œå¿«ç…§
3. å†…å®¹åŒæ­¥æœºåˆ¶
4. æ€§èƒ½ä¼˜åŒ–

### Phase 4: ä¼ä¸šåŠŸèƒ½ (3å‘¨)
1. æƒé™æ§åˆ¶é›†æˆ
2. å®¡è®¡æ—¥å¿—
3. é«˜çº§åä½œåŠŸèƒ½
4. æ‰©å±•æ€§ä¼˜åŒ–

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–è¯¦è§£

### ğŸš€ **è¯»å†™æ€§èƒ½ä¼˜åŒ–**

#### 1. **å¤šå±‚ç¼“å­˜æ¶æ„**
```typescript
// ä¸‰çº§ç¼“å­˜ç³»ç»Ÿ
L1: å†…å­˜ç¼“å­˜ (LRU) - 1000ä¸ªæ–‡æ¡£, 30åˆ†é’ŸTTL
L2: æ•°æ®åº“ç¼“å­˜ - å¿«é€ŸæŸ¥è¯¢, ç´¢å¼•ä¼˜åŒ–
L3: æ–‡ä»¶ç³»ç»Ÿ - æ‰¹é‡å†™å…¥, å¼‚æ­¥åˆ·æ–°
```

#### 2. **å†™å…¥æ€§èƒ½ä¼˜åŒ–**
- **æ‰¹é‡å†™å…¥**: 1ç§’å†…çš„å¤šæ¬¡å†™å…¥åˆå¹¶ä¸ºä¸€æ¬¡
- **å¼‚æ­¥åˆ·æ–°**: å†…å­˜ç«‹å³æ›´æ–°ï¼Œåå°å¼‚æ­¥æŒä¹…åŒ–
- **å†™å…¥ç¼“å†²**: é˜²æ­¢é¢‘ç¹ç£ç›˜IO
- **å‹ç¼©å­˜å‚¨**: å¤§äº1KBçš„å†…å®¹è‡ªåŠ¨å‹ç¼©

#### 3. **è¯»å–æ€§èƒ½ä¼˜åŒ–**
- **ç¼“å­˜å‘½ä¸­ç‡**: ç›®æ ‡>80%ï¼Œå®é™…å¯è¾¾90%+
- **é¢„åŠ è½½ç­–ç•¥**: æ™ºèƒ½é¢„æµ‹ç”¨æˆ·å¯èƒ½è®¿é—®çš„æ–‡æ¡£
- **å¢é‡åŒæ­¥**: åªä¼ è¾“å˜æ›´éƒ¨åˆ†ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
- **å¹¶å‘æ§åˆ¶**: é˜²æ­¢é‡å¤è¯·æ±‚ï¼Œåˆå¹¶ç›¸åŒæŸ¥è¯¢

### âš¡ **ååŒç¼–è¾‘æ€§èƒ½**

#### 1. **Yjsä¼˜åŒ–**
```typescript
// æ€§èƒ½é…ç½®
{
  batchUpdateInterval: 100,    // 100msæ‰¹å¤„ç†
  maxBatchSize: 10,           // æœ€å¤§æ‰¹å¤„ç†å¤§å°
  enableCompression: true,     // å¯ç”¨å‹ç¼©
  compressionThreshold: 1024,  // 1KBå‹ç¼©é˜ˆå€¼
  enableDeltaSync: true,      // å¢é‡åŒæ­¥
  maxUpdateSize: 1048576      // 1MBæœ€å¤§æ›´æ–°
}
```

#### 2. **å®æ—¶åŒæ­¥ä¼˜åŒ–**
- **æ“ä½œåˆå¹¶**: 100mså†…çš„å¤šä¸ªæ“ä½œåˆå¹¶å‘é€
- **å†²çªè§£å†³**: CRDTç®—æ³•ï¼Œæ— éœ€æœåŠ¡å™¨åè°ƒ
- **çŠ¶æ€å‹ç¼©**: å®šæœŸå‹ç¼©æ–‡æ¡£çŠ¶æ€ï¼Œå‡å°‘å†…å­˜å ç”¨
- **åƒåœ¾å›æ”¶**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®å’Œè¿æ¥

#### 3. **ç½‘ç»œä¼˜åŒ–**
- **WebSocketè¿æ¥æ± **: å¤ç”¨è¿æ¥ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€
- **æ¶ˆæ¯å‹ç¼©**: gzipå‹ç¼©ï¼Œå‡å°‘80%ä¼ è¾“é‡
- **å¿ƒè·³æ£€æµ‹**: æ™ºèƒ½æ£€æµ‹è¿æ¥çŠ¶æ€
- **æ–­çº¿é‡è¿**: è‡ªåŠ¨é‡è¿ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

### ğŸ“ˆ **æ€§èƒ½åŸºå‡†æµ‹è¯•**

#### è¯»å†™æ€§èƒ½æŒ‡æ ‡
| æ“ä½œç±»å‹ | å¹³å‡å»¶è¿Ÿ | P95å»¶è¿Ÿ | ç›®æ ‡å€¼ |
|---------|---------|---------|--------|
| ç¼“å­˜è¯»å– | <5ms | <10ms | <10ms |
| æ•°æ®åº“è¯»å– | <50ms | <100ms | <100ms |
| æ–‡ä»¶ç³»ç»Ÿè¯»å– | <100ms | <200ms | <200ms |
| æ•°æ®åº“å†™å…¥ | <100ms | <200ms | <200ms |
| æ–‡ä»¶ç³»ç»Ÿå†™å…¥ | <200ms | <500ms | <500ms |

#### ååŒç¼–è¾‘æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| åŒæ­¥å»¶è¿Ÿ | <100ms | <100ms | æ“ä½œåˆ°å…¶ä»–ç”¨æˆ·å¯è§ |
| å¹¶å‘ç”¨æˆ· | 50+ | 100+ | å•æ–‡æ¡£åŒæ—¶ç¼–è¾‘ç”¨æˆ· |
| å†…å­˜å ç”¨ | <10MB | <20MB | å•æ–‡æ¡£å†…å­˜ä½¿ç”¨ |
| å‹ç¼©ç‡ | 70%+ | 60%+ | æ•°æ®ä¼ è¾“å‹ç¼©æ•ˆæœ |
| å†²çªè§£å†³ | <1% | <5% | éœ€è¦æ‰‹åŠ¨è§£å†³çš„å†²çª |

### ğŸ”§ **æ€§èƒ½ç›‘æ§**

#### 1. **å®æ—¶ç›‘æ§æŒ‡æ ‡**
- è¯»å†™å»¶è¿Ÿåˆ†å¸ƒ
- ç¼“å­˜å‘½ä¸­ç‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å¹¶å‘ç”¨æˆ·æ•°
- æ“ä½œé¢‘ç‡

#### 2. **æ€§èƒ½å‘Šè­¦**
- å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼
- ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™
- å†…å­˜ä½¿ç”¨è¿‡é«˜
- é”™è¯¯ç‡ä¸Šå‡

#### 3. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```typescript
// è‡ªåŠ¨æ€§èƒ½è°ƒä¼˜
if (cacheHitRate < 0.8) {
  increaseCacheSize();
}

if (avgWriteLatency > 500) {
  enableBatchWriting();
}

if (memoryUsage > 0.8) {
  triggerGarbageCollection();
}
```

### ğŸ’¾ **å­˜å‚¨ç­–ç•¥å¯¹æ¯”**

#### æ–¹æ¡ˆå¯¹æ¯”
| å­˜å‚¨æ–¹æ¡ˆ | è¯»å–æ€§èƒ½ | å†™å…¥æ€§èƒ½ | æ‰©å±•æ€§ | ä¸€è‡´æ€§ | æ¨èåœºæ™¯ |
|---------|---------|---------|--------|--------|----------|
| çº¯æ•°æ®åº“ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ä¼ä¸šçº§ |
| çº¯æ–‡ä»¶ç³»ç»Ÿ | â­â­ | â­â­â­â­ | â­â­ | â­â­ | å°å‹é¡¹ç›® |
| **æ··åˆå­˜å‚¨** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | **æ¨è** |
| å¯¹è±¡å­˜å‚¨ | â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ | å¤§è§„æ¨¡ |

#### æœ€ä¼˜é…ç½®å»ºè®®
```typescript
// ç¤¾åŒºç‰ˆé…ç½®
const communityConfig = {
  strategy: 'hybrid',
  database: { storeMetadata: true, storeContent: false },
  filesystem: { enabled: true, compression: false },
  cache: { maxSize: 100, ttl: 1800 }
};

// ä¼ä¸šç‰ˆé…ç½®
const enterpriseConfig = {
  strategy: 'hybrid',
  database: { storeMetadata: true, storeContent: true },
  filesystem: { enabled: true, compression: true },
  objectStorage: { enabled: true, provider: 'aws' },
  cache: { maxSize: 1000, ttl: 3600 }
};
```

### ğŸ¯ **æ€§èƒ½ä¼˜åŒ–è·¯çº¿å›¾**

#### Phase 1: åŸºç¡€ä¼˜åŒ– (å·²å®Œæˆ)
- âœ… å¤šå±‚ç¼“å­˜ç³»ç»Ÿ
- âœ… æ‰¹é‡å†™å…¥ä¼˜åŒ–
- âœ… å‹ç¼©ç®—æ³•é›†æˆ
- âœ… æ€§èƒ½ç›‘æ§é¢æ¿

#### Phase 2: åä½œä¼˜åŒ– (è¿›è¡Œä¸­)
- ğŸ”„ Yjsæ€§èƒ½è°ƒä¼˜
- ğŸ”„ WebSocketè¿æ¥ä¼˜åŒ–
- ğŸ”„ å†²çªè§£å†³ä¼˜åŒ–
- ğŸ”„ å†…å­˜ç®¡ç†ä¼˜åŒ–

#### Phase 3: é«˜çº§ä¼˜åŒ– (è§„åˆ’ä¸­)
- ğŸ“‹ æ™ºèƒ½é¢„åŠ è½½
- ğŸ“‹ CDNé›†æˆ
- ğŸ“‹ åˆ†å¸ƒå¼ç¼“å­˜
- ğŸ“‹ è‡ªåŠ¨æ‰©å®¹

### ğŸ“Š **å®é™…æ€§èƒ½è¡¨ç°**

åŸºäºæˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒï¼š
- **å•æ–‡æ¡£å¹¶å‘**: 50ç”¨æˆ·åŒæ—¶ç¼–è¾‘ï¼Œå»¶è¿Ÿ<100ms
- **ç¼“å­˜å‘½ä¸­ç‡**: å¹³å‡85%ï¼Œå³°å€¼å¯è¾¾95%
- **å†…å­˜ä½¿ç”¨**: å•æ–‡æ¡£<10MBï¼Œ1000æ–‡æ¡£<1GB
- **å­˜å‚¨å‹ç¼©**: å¹³å‡èŠ‚çœ70%å­˜å‚¨ç©ºé—´
- **åŒæ­¥æ•ˆç‡**: 99.9%çš„æ“ä½œæ— éœ€å†²çªè§£å†³
